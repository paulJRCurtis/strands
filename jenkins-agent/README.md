# Strands Jenkins Agent

This directory contains the Docker configuration for a Jenkins agent specifically designed to run the Strands Security Analysis Platform CI/CD pipeline.

## Files

- **`Dockerfile`** - Jenkins agent image with all required tools
- **`docker-compose.yml`** - Complete Jenkins setup with agent
- **`AGENT_REQUIREMENTS.md`** - Detailed requirements documentation
- **`verify-agent.sh`** - Script to verify agent setup
- **`README.md`** - This file

## Quick Start

### Jenkins controller must be running
```bash
sudo systemctl start jenkins
```

### 1. Build the Agent Image

```bash
docker build -t strands-jenkins-agent .
```

### Jenkins Controller Security Configuration
Ensure TCP port for inbound connections is not disabled


### 2. Get Jenkins Agent Secret

The `JENKINS_SECRET` is generated by Jenkins when you create a new agent:

1. **In Jenkins UI:**
   - Go to "Manage Jenkins" → "Manage Nodes and Clouds"
   - Click "New Node" → Enter name "strands-docker-agent" → Select "Permanent Agent"
   - Configure:
     - Remote root directory: `/home/jenkins/agent`
     - Launch method: "Launch agent by connecting it to the controller"
   - Save the node
   - **Copy the secret from the agent connection command**

2. **Example connection command shown by Jenkins:**
   ```bash
   java -jar agent.jar -jnlpUrl http://jenkins:8080/computer/strands-docker-agent/slave-agent.jnlp -secret bdb0525d9a6bb8ac82871c3c31b725fd56706341476761dffa6e7f78c6d4bebe
   ```
   The secret is: `bdb0525d9a6bb8ac82871c3c31b725fd56706341476761dffa6e7f78c6d4bebe`

### 3. Run with Docker Compose

```bash
# Set required environment variables
export JENKINS_URL=http://host.docker.internal:8080 # This is used for the jenkins controller running local
export JENKINS_SECRET=bdb0525d9a6bb8ac82871c3c31b725fd56706341476761dffa6e7f78c6d4bebe
export JENKINS_AGENT_NAME=strands-docker-agent

# Start Jenkins and agent
docker compose up -d
```

### 3. Verify Agent Setup

```bash
# Run verification inside the container
docker exec strands-jenkins-agent ./verify-agent.sh
```

To connect to the container 

```bash
docker exec -it strands-jenkins-agent /bin/bash
```


## Key Features

- **Docker-in-Docker** support with socket mounting
- **Multi-language support** (Python 3.8+, Node.js 16+)
- **Security tools** (Bandit, Trivy, SonarQube Scanner)
- **Testing frameworks** (Pytest, npm test)
- **Container orchestration** (Docker Compose)
- **Resource optimization** with caching volumes

## Usage in Jenkins

1. Configure Jenkins to use this Docker image as an agent
2. Ensure Docker socket is mounted: `-v /var/run/docker.sock:/var/run/docker.sock`
3. Set appropriate environment variables
4. Run the Strands pipeline

## Troubleshooting

- **Docker permission issues**: Ensure jenkins user is in docker group
- **Socket not found**: Verify Docker socket is mounted correctly
- **Network issues**: Check Jenkins URL and network connectivity
- **Tool missing**: Run verification script to identify missing components

For detailed requirements, see `AGENT_REQUIREMENTS.md`.